<!-- user.component.html – 2025 ELITE USER PROFILE + GLOBAL REPORT BOX -->
<div class="user-profile-wrapper">

  <!-- HEADER -->
  <header class="profile-header">
    <button mat-icon-button class="back-btn" (click)="goBack()" matTooltip="Back">
      <mat-icon>arrow_back_ios_new</mat-icon>
    </button>
    <h1>@{{ profile.username || 'Loading...' }}</h1>
    <div class="header-spacer"></div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="profile-content">

    <!-- ERROR -->
  <!-- FLOATING TOAST NOTIFICATIONS – ALWAYS VISIBLE WHEN SCROLLING -->
<div class="toast-container">
  <div *ngIf="errorMessage" class="toast-notification error" 
       [class.show]="errorMessage" 
       (click)="errorMessage = ''">
    <mat-icon>error_outline</mat-icon>
    <span>{{ errorMessage }}</span>
    <button mat-icon-button class="close-toast" (click)="errorMessage = ''">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</div>

    <!-- PROFILE CARD -->
    <mat-card class="hero-card" appearance="outlined">
      <mat-card-content class="hero-content">

        <!-- Avatar + Username -->
        <div class="top-section">
          <div class="avatar-large"
               [style.background-image]="'url(' + getAvatarUrl(profile.username) + ')'">
          </div>
          <div class="user-info">
            <h2 class="username">@{{ profile.username }}</h2>
            <p class="bio" *ngIf="profile.bio">{{ profile.bio }}</p>
            <p class="no-bio" *ngIf="!profile.bio">No bio yet</p>
          </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
          <div class="stat">
            <div class="value">{{ posts.length }}</div>
            <div class="label">Posts</div>
          </div>
          <div class="stat">
            <div class="value">{{ profile.followers || 0 }}</div>
            <div class="label">Followers</div>
          </div>
          <div class="stat">
            <div class="value">{{ profile.following || 0 }}</div>
            <div class="label">Following</div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button mat-raised-button 
                  [color]="isFollowing ? 'warn' : 'primary'"
                  (click)="follow()"
                  class="follow-btn">
            <mat-icon>{{ isFollowing ? 'person_remove' : 'person_add' }}</mat-icon>
            {{ isFollowing ? 'Unfollow' : 'Follow' }}
          </button>

          <button mat-stroked-button color="warn" (click)="reportProfile()" class="report-btn">
            <mat-icon>flag</mat-icon>
            Report Profile
          </button>
        </div>

        <!-- Info Grid -->
        <div class="info-grid">
          <div class="info-item">
            <mat-icon>cake</mat-icon>
            <span *ngIf="profile.age">Age {{ profile.age }}</span>
            <span *ngIf="!profile.age" class="muted">Age not set</span>
          </div>
          <div class="info-item">
            <mat-icon>alternate_email</mat-icon>
            <span class="muted">{{profile.email}}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- POSTS SECTION -->
    <mat-card class="posts-card" appearance="outlined">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>grid_on</mat-icon>
          Posts
        </mat-card-title>
        <mat-card-subtitle>{{ posts.length }} posts</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div *ngIf="posts.length === 0" class="empty-posts">
          <mat-icon class="big-icon">mood_bad</mat-icon>
          <p>No posts yet</p>
        </div>

        <!-- POSTS GRID -->
        <div class="posts-grid" *ngIf="posts.length > 0">
          <div class="post-item" *ngFor="let post of posts" (click)="goToPost(post.id)">
            <div class="post-media-container" *ngIf="post.mediaPaths?.length > 0">
              <img *ngIf="post.mediaTypes[0]?.startsWith('image')"
                   [src]="'http://localhost:8080' + post.mediaPaths[0]"
                   class="post-thumb" />
              <video *ngIf="post.mediaTypes[0]?.startsWith('video')"
                     class="post-thumb"
                     preload="metadata">
                <source [src]="'http://localhost:8080' + post.mediaPaths[0]" [type]="post.mediaTypes[0]">
              </video>
              <div class="play-overlay" *ngIf="post.mediaTypes[0]?.startsWith('video')">
                <mat-icon>play_circle</mat-icon>
              </div>
              <div class="media-count" *ngIf="post.mediaPaths.length > 1">
                <mat-icon>collections</mat-icon>
                {{ post.mediaPaths.length }}
              </div>
            </div>

            <div class="post-info">
              <h3>{{ post.title || 'Untitled' }}</h3>
              <p>{{ post.content | slice:0:100 }}{{ post.content.length > 100 ? '...' : '' }}</p>
              <small class="date">{{ post.createdAt | date:'mediumDate' }}</small>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </main>

  <!-- GLOBAL REPORT PROFILE BOX – CENTERED & BEAUTIFUL -->
  <div class="global-report-overlay" *ngIf="showReportProfileBox" (click)="showReportProfileBox = false">
    <div class="global-report-box" (click)="$event.stopPropagation()">
      <div class="report-header">
        <mat-icon color="warn">warning</mat-icon>
        <h3>Report Profile @{{ profile.username }}</h3>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Reason (optional)</mat-label>
        <textarea matInput rows="4" 
                  [(ngModel)]="reportProfileReason" 
                  placeholder="Why are you reporting this user?"></textarea>
      </mat-form-field>

      <div class="report-actions">
        <button mat-button (click)="showReportProfileBox = false">Cancel</button>
        <button mat-raised-button color="warn" (click)="sendProfileReport()">
          <mat-icon>flag</mat-icon> Report User
        </button>
      </div>
    </div>
  </div>
</div>